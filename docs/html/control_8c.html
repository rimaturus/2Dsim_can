<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>2D FSAE simulator: src/control.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">2D FSAE simulator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">control.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements vehicle control functions including both manual (keyboard) and autonomous (centerline based) control.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;allegro.h&gt;</code><br />
<code>#include &quot;<a class="el" href="trajectory_8h_source.html">trajectory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="perception_8h_source.html">perception.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="globals_8h_source.html">globals.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="vehicle_8h_source.html">vehicle.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for control.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="control_8c__incl.svg" width="608" height="411"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa7d41004f6e6355c5dd871a9a8c8a59d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="control_8c.html#aa7d41004f6e6355c5dd871a9a8c8a59d">keyboard_control</a> (float *<a class="el" href="globals_8c.html#a4a4a6918df3caa78a889c76207349a02">car_x</a>, float *<a class="el" href="globals_8c.html#a2ff6267ace75a40353ce62fdb02b9e67">car_y</a>, int *<a class="el" href="globals_8c.html#ad9878a31df3b8d7db61cf55b7eb07cd4">car_angle</a>)</td></tr>
<tr class="memdesc:aa7d41004f6e6355c5dd871a9a8c8a59d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjusts vehicle controls based on keyboard input.  <a href="control_8c.html#aa7d41004f6e6355c5dd871a9a8c8a59d">More...</a><br /></td></tr>
<tr class="separator:aa7d41004f6e6355c5dd871a9a8c8a59d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7f0354fe7078dc6c93c9443ab06623c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="control_8c.html#aa7f0354fe7078dc6c93c9443ab06623c">autonomous_control</a> (float *<a class="el" href="globals_8c.html#a4a4a6918df3caa78a889c76207349a02">car_x</a>, float *<a class="el" href="globals_8c.html#a2ff6267ace75a40353ce62fdb02b9e67">car_y</a>, int *<a class="el" href="globals_8c.html#ad9878a31df3b8d7db61cf55b7eb07cd4">car_angle</a>, <a class="el" href="structwaypoint.html">waypoint</a> *center_waypoints)</td></tr>
<tr class="memdesc:aa7f0354fe7078dc6c93c9443ab06623c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Autonomous control routine using centerline waypoints.  <a href="control_8c.html#aa7f0354fe7078dc6c93c9443ab06623c">More...</a><br /></td></tr>
<tr class="separator:aa7f0354fe7078dc6c93c9443ab06623c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa469e51bab916bcd3fc763e8563db01b"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="control_8c.html#aa469e51bab916bcd3fc763e8563db01b">pedal</a> = 0.0f</td></tr>
<tr class="separator:aa469e51bab916bcd3fc763e8563db01b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf65b77f4a341762b97d645dd857e021"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="control_8c.html#abf65b77f4a341762b97d645dd857e021">steering</a> = 0.0f</td></tr>
<tr class="memdesc:abf65b77f4a341762b97d645dd857e021"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls the vehicle using keyboard input.  <a href="control_8c.html#abf65b77f4a341762b97d645dd857e021">More...</a><br /></td></tr>
<tr class="separator:abf65b77f4a341762b97d645dd857e021"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements vehicle control functions including both manual (keyboard) and autonomous (centerline based) control. </p>
<p>This file contains methods to update the vehicle's motion state. The manual control routine (keyboard_control) processes user keystrokes to adjust speed (pedal) and steering angle, while the autonomous control routine uses a centerline of waypoints to compute a reference trajectory and derive the appropriate steering correction. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aa7f0354fe7078dc6c93c9443ab06623c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7f0354fe7078dc6c93c9443ab06623c">&#9670;&nbsp;</a></span>autonomous_control()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void autonomous_control </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>car_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>car_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>car_angle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwaypoint.html">waypoint</a> *&#160;</td>
          <td class="paramname"><em>center_waypoints</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Autonomous control routine using centerline waypoints. </p>
<p>Implements an autonomous control strategy based on a provided centerline represented by an array of waypoints. The function follows these steps:</p><ul>
<li>Counts the number of valid centerline waypoints (terminated when a waypoint with x &lt; 0.0f is found).</li>
<li>Filters the centerline to extract waypoints that are located ahead of the vehicle using the is_in_front helper.</li>
<li>Identifies the closest valid waypoint ahead, and depending on the availability of neighboring points, computes a reference trajectory vector. This is done in one of three ways:<ul>
<li>If at least three valid ahead waypoints exist, the reference vector is computed from the previous to the next waypoint surrounding the closest ahead waypoint.</li>
<li>If there are only one or two ahead points (but at least two total waypoints), the reference vector is derived by combining the vector from the vehicle to the last waypoint and the segment between the last two waypoints.</li>
<li>If only one waypoint is available, the vector from the vehicle to that waypoint is used as the reference.</li>
</ul>
</li>
<li>The computed reference trajectory is normalized. If normalization fails, a default forward direction is used.</li>
<li>The vehicle's current heading is computed as a unit vector based on car_angle.</li>
<li>The required steering correction (delta) is obtained by computing the sine of the angle difference through the 2D cross product between the normalized reference vector and the heading vector.</li>
<li>A constant pedal value is applied.</li>
<li>Finally, the updated control signals (pedal and delta for steering) are applied to the vehicle by calling vehicle_model.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_x</td><td>Pointer to the vehicle's x-coordinate (in meters). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_y</td><td>Pointer to the vehicle's y-coordinate (in meters). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_angle</td><td>Pointer to the vehicle's orientation angle (in degrees). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">center_waypoints</td><td>Pointer to an array of waypoints representing the desired centerline trajectory. The array should be terminated by a waypoint with x &lt; 0.0f. </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="control_8c_aa7f0354fe7078dc6c93c9443ab06623c_cgraph.svg" width="331" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="control_8c_aa7f0354fe7078dc6c93c9443ab06623c_icgraph.svg" width="419" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa7d41004f6e6355c5dd871a9a8c8a59d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7d41004f6e6355c5dd871a9a8c8a59d">&#9670;&nbsp;</a></span>keyboard_control()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void keyboard_control </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>car_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>car_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>car_angle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjusts vehicle controls based on keyboard input. </p>
<p>This function processes the state of keyboard keys to adjust the vehicle's pedal (speed) and steering angle. It increments or decrements the pedal value and steering angle within pre-defined limits depending on the keys pressed (e.g., KEY_UP, KEY_DOWN, KEY_LEFT, KEY_RIGHT). After updating these control signals, the vehicle's state is updated by calling the vehicle_model function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_x</td><td>Pointer to the vehicle's x-coordinate (in meters). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_y</td><td>Pointer to the vehicle's y-coordinate (in meters). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">car_angle</td><td>Pointer to the vehicle's orientation angle (in degrees). </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="control_8c_aa7d41004f6e6355c5dd871a9a8c8a59d_cgraph.svg" width="311" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="control_8c_aa7d41004f6e6355c5dd871a9a8c8a59d_icgraph.svg" width="399" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aa469e51bab916bcd3fc763e8563db01b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa469e51bab916bcd3fc763e8563db01b">&#9670;&nbsp;</a></span>pedal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float pedal = 0.0f</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="abf65b77f4a341762b97d645dd857e021"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf65b77f4a341762b97d645dd857e021">&#9670;&nbsp;</a></span>steering</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float steering = 0.0f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Controls the vehicle using keyboard input. </p>
<p>Processes user keyboard inputs to modify the vehicle's position and orientation. The function updates the car's x and y coordinates, as well as its angular orientation (in degrees).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">car_x</td><td>Pointer to the car's x-coordinate. </td></tr>
    <tr><td class="paramname">car_y</td><td>Pointer to the car's y-coordinate. </td></tr>
    <tr><td class="paramname">car_angle</td><td>Pointer to the car's current angle (in degrees).</td></tr>
  </table>
  </dd>
</dl>
<p>Controls the vehicle autonomously along a given trajectory.</p>
<p>Uses the provided trajectory (a sequence of waypoints) to automatically adjust the vehicle's steering and pedal inputs. This function updates the car's position and orientation by computing the necessary control actions based on the navigation path.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">car_x</td><td>Pointer to the car's x-coordinate. </td></tr>
    <tr><td class="paramname">car_y</td><td>Pointer to the car's y-coordinate. </td></tr>
    <tr><td class="paramname">car_angle</td><td>Pointer to the car's current orientation angle (in degrees). </td></tr>
    <tr><td class="paramname">trajectory</td><td>Pointer to the waypoint structure that defines the trajectory. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
